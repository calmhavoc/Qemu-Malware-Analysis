#!/usr/bin/python

#import subprocess
import qemu_handler as qh 
from agent_server import * 

# Need to make a config file or gather info from questions

# Test command
# cmd = qh.get_commands(command = "snap_list",name="win7")
# print(cmd)
# a,b = qh.run_command(cmd)

# # Revert VM to base snapshot
# cmd = qh.get_commands(command = "snap_revert",name="win7", snapname="base")
# out,err = qh.run_command(cmd)

# # Start VM (if not started)
# # Get VM state later
# cmd = qh.get_commands(command = "start",name="win7")
# out,err = qh.run_command(cmd)



imagename = "win7"
snapname = "base"
localmaldir = "./malware"
executable = "Client.exe"
remoteuser = "james"
windst = "c:\\Windows\\Temp\\"
runtime = 120


def begin_autorun(imagename, snapname):
    cmd = qh.get_commands(command = "snap_revert",name=imagename, snapname=snapname)
    out,err = qh.run_command(cmd)
    print(out)
    print(err)

begin_autorun("win7","base")

start = Server()

start.imagename = imagename
start.snapname = snapname
start.localmaldir = localmaldir
start.executable = executable
start.windst = windst
start.runtime = runtime


host = "0.0.0.0"
port = 8080

start.connect(host,port)



